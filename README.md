# Single-human 6D pose estimation based on fusion of IMU and multi-view images

# Background
目前，人体姿态估计主要分为三种方法：1）运动捕捉设备；2）IMU测量；3）视觉。运动捕捉设备精度高、价格昂贵；IMU缺少绝对位置信息；视觉能够提供关节位置的绝对信息，但无法测量旋转信息。为此，我们结合IMU和视觉的优势，提出一种多传感器信息融合的人体姿态估计方法。

# The context of our framework:
 ## 1. Human upper body model
 
 人体上肢运动学模型为包含 10 个连杆的运动系统, 其中根连杆 h0（髋部）为人体基坐标系, 包含相对世界坐标系表示的姿态 R 和位移 t , 其余子连杆hj, j ∈ {1,2, · · · , 9}通过球形关节与父连杆连接, 相对于父连杆有旋转R和常量连杆位移 t. 在考虑人体基坐标系姿态 R 和位移 t的情况下,人体上肢可以看作一个具有 33 个自由度的运动系
统, 构造向量 θh =[(t_g^h0), 0_T h0, θ_T^h1· · · θ_T^h9]^T 以表示人体上肢模型的姿态信息.
  
 ![QQ截图20210719081923](https://user-images.githubusercontent.com/52600391/126127071-12ac66d1-6809-457d-8863-1a365f19c269.png)

![image](https://user-images.githubusercontent.com/52600391/126116124-7167d3e3-5b78-4a1c-9c63-8892489ee3cb.png)


  ## 2. Cost function

人体动作估计需要融合视觉和 IMU 传感器的数据, 对 θh 进行求解. 建立关于 θh 的目标函数

E (θh) = αRER (θh)+αPEP (θh)+αLEL (θh) (5)

其中 ER (θh) 为人体上肢模型中连杆姿态与 IMU 测得肢体姿态的误差项, EP (θh) 表示视觉传感器测得的人体肢体位置的误差项, EL (θh) 为人体关节自由度约束项, αR、αP 、αL 分别为上述 3 项的权重系数. 通过最小化 E (θh) 能够求得融合了视觉信息与 IMU 信息的人体动作估计结果 θh.

   IMU error:
     IMU误差项包括旋转误差项和加速度误差项。
     对于旋转误差项，我们假设一个世界坐标系，先把关节坐标都在世界坐标系下表示，再通过关节与IMU传感器之间的固定的旋转偏差，将传感器的姿态在世界坐标系下表示，即得到IMU传感器的姿态推导值；又IMU本身拥有自己的坐标系，因此把IMU自身获取的姿态在世界坐标下表示的旋转信息作为测量值。
     
加速度与当前时刻位置信息有关，对于加速度误差项，当前时刻的肢体加速度是无法通过推导得出的，只能通过记录前2个时刻的肢体位置来计算上一时刻的肢体加速度（推导值），和保存上一时刻IMU加速度（测量值），对于某一关节测量值是由当前肢体在世界坐标系中旋转信息乘传感器测量加速度，在加上重力补偿。
     
     Q:加速度误差项带来的潜在问题？如何解决？
     A:由于二次积分，加速度可能会造成累计误差，造成姿态估计不准确。在我们的方法中，利用其它传感信息（如视觉）对IMU位置进行补偿，因此可以消除积分带来的累计误差。
    
   Position error:
    首先, 多台相机捕捉到的画面内容通过 2D 姿态求解器以获得操作人员在图像坐标系下的肢体关键点位置（测量值）， 各个 2D 关键点坐标包含对应的像素坐标和置信度λ, 表示该关键点被正确识别的概率。
   
   每一个关节的空间位置在人体模型建立时由骨架长度计算得来，我们将该空间三维结果通过投影至相机像素坐标（推导值）。通过构建误差，约束关节位置。
   
  Prior constraint term: 在建立人体运动学模型时，虽然人体的每一个连杆关节具有3个自由度，但对于实际的人体，大部分的关节都有着运动方向和角度上的限制，并非所有的关节都能满足3个自由度上的自由旋转。利用Total capture数据集提供的人体姿态数据建立先验约束，从而达到约束关节自由度的效果。
  
  ## 3. Optimization
  
  通过对人体姿态数据集的分析, 能够得到各人体关节角 θhj 的上下限 θmin和 θmax. 人体姿态求解的优化问题定义如下:
  
objective : min E (θh) s.t :θmin <= θh <= θmax

  在优化问题中给定接近最优解的初始迭代值能够提升梯度下降的效率, 并减少求解陷入局部最优的可能性, 为此使用前一组数据所求得的姿态结果作为初始迭代值来进行优化问题的求解. 而对于优化第一组数据, 由于没有上一时刻的结果可以利用, 设计了初始化阶段以提供最初的迭代值. 在初始化阶段中, 预先定义了一个初始姿态 θ_init （一般为T-pose：即保持身体直立, 双手向两侧平举的姿态）,操作人员需要和初始姿态保持吻合, 再以初始姿态θ_init 作为当前优化问题的初始值进行姿态求解, 以计算得到第一组数据的姿态估计结果. 
