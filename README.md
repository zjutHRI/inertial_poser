# Single-human 6D pose estimation based on fusion of IMU and multi-view images

The context of our framework:
  1. Human upper body model
 
 人体上肢运动学模型为包含 10 个连杆的运动系统, 其中根连杆 h0（髋部）为人体基坐标系, 包含相对世界坐标系表示的姿态 R 和位移 t , 其余子连杆hj, j ∈ {1,2, · · · , 9}通过球形关节与父连杆连接, 相对于父连杆有旋转R和常量连杆位移 t. 在考虑人体基坐标系姿态 R 和位移 t的情况下,人体上肢可以看作一个具有 33 个自由度的运动系
统, 构造向量 θh =[(t_g^h0), 0_T h0, θ_T^h1· · · θ_T^h9]^T 以表示人体上肢模型的姿态信息.
  
 ![QQ截图20210719081923](https://user-images.githubusercontent.com/52600391/126127071-12ac66d1-6809-457d-8863-1a365f19c269.png)

![image](https://user-images.githubusercontent.com/52600391/126116124-7167d3e3-5b78-4a1c-9c63-8892489ee3cb.png)


  2. Cost function

人体动作估计需要融合视觉和 IMU 传感器的数据, 对 θh 进行求解. 建立关于 θh 的目标函数

E (θh) = αRER (θh)+αPEP (θh)+αLEL (θh) (5)

其中 ER (θh) 为人体上肢模型中连杆姿态与 IMU 测得肢体姿态的误差项, EP (θh) 表示视觉传感器测得的人体肢体位置的误差项, EL (θh) 为人体关节自由度约束项, αR、αP 、αL 分别为上述 3 项的权重系数. 通过最小化 E (θh) 能够求得融合了视觉信息与 IMU 信息的人体动作估计结果 θh.

   IMU error:
    人体姿态估计中, IMU 佩戴方式如图 4 所示,需要在腰部, 左右手臂和左右手掌佩戴 IMU. 各个IMU 能够检测自身在世界坐标系下的姿态 RgIj, Ij对应其追踪的肢体连杆 hj . 在佩戴好 IMU 后, 肢体连杆坐标系 hj 与 IMU 传感器坐标系 Ij 存在固定的旋转偏差 RhjIj, 该偏差能够在人体姿态估计的初始化阶段通过动作标定计算得出.
    
   Position error:
    首先, 多台相机捕捉到的画面内容通过 2D 姿态求解器以获得操作人员在图像坐标系下的肢体关键点位置. 各个 2D 关键点坐标 t∈ R2 有对应的关键点置信度 λ∈ [0,1], 表示该关键点被正确识别的概率. 为了方便表示, 人体上肢模型中的各连杆坐标系与对应的 2D 关键点都记作 hj . 虚拟空间中 hj 的空间位置估计值 ˆt∈ R3 由的位移部分计算得出. 为了比较估计值 ˆt与姿态求解器输出的 2D 关键点 t的偏差, 将 ˆt投影至相机的图像坐标系下;

  3. Optimization
  
  通过对人体姿态数据集的分析, 能够得到各人体关节角 θhj 的上下限 θmin和 θmax. 人体姿态求解的优化问题定义如下:
  
objective : min E (θh) s.t :θmin <= θh <= θmax

  在优化问题中给定接近最优解的初始迭代值能够提升梯度下降的效率, 并减少求解陷入局部最优的可能性, 为此使用前一组数据所求得的姿态结果作为初始迭代值来进行优化问题的求解. 而对于优化第一组数据, 由于没有上一时刻的结果可以利用, 设计了初始化阶段以提供最初的迭代值. 在初始化阶段中, 预先定义了一个初始姿态 θ_init （一般为T-pose：即保持身体直立, 双手向两侧平举的姿态）,操作人员需要和初始姿态保持吻合, 再以初始姿态θ_init 作为当前优化问题的初始值进行姿态求解, 以计算得到第一组数据的姿态估计结果. 
